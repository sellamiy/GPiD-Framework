module Oopsla31
 use int.Int
 use ref.Ref

 val unknown (unit) : bool

 let main (n: int) (m: int) : unit
  requires { m + 1 < n }
  diverges
 = let i = ref 0 in let j = ref 0 in

  while !i < n do
   invariant { true }

   j := !i;
   while !j < m do
    invariant { true }

    if unknown() then begin

     assert { !j >= 0 };
     j := !j + 1;
     for k = 0 to !j - 1 do
      invariant { true }
      ()
     done

    end else begin

     assert { n + !j + 5 > !i };
     j := !j + 2;

    end

   done;

   i := !i + 4
  done

end
