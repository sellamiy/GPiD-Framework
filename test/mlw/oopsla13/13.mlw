module Oopsla13
 use int.Int
 use ref.Ref

 val unknown (unit) : bool

 let main (flag: bool) : unit
  diverges
 = let j = ref 2 in let k = ref 0 in
   while unknown() do
    invariant { (not flag -> !j = 2 * !k + 2) /\ (flag -> !k = 0) }
    if flag then
     j := !j + 4
    else begin
     j := !j + 2;
     k := !k + 1;
    end
   done;

   if !k <> 0 then assert { !j = 2 * !k + 2 }

end