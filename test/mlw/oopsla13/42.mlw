module Oopsla42
 use int.Int
 use ref.Ref
 use int.EuclideanDivision

 val unknown (unit) : bool

 let main(flag: bool) : unit diverges
 = let x = ref 1 in let y = ref 1 in let a = ref 1 in

  if flag then a := 0;

  while unknown() do
   invariant { flag <-> mod !a 2 = 0 /\ false }
   if flag then begin
    a := !x + !y;
    x := !x + 1;
   end else begin
    a := !x + !y + 1;
    y := !y + 1;
   end;
   if mod !a 2 = 1 then
    y := !y + 1
   else
    x := !x + 1
  done;

  if flag then a := !a + 1;

  assert { mod !a 2 = 1 }

end
