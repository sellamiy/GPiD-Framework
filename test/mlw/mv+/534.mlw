module Sum

  (* computes the sum a[1] + ... + a[n] *)

  use int.Int
  use ref.Ref
  use array.Array
  use array.ArraySum

  let sum (a: array int) (n: int)
    requires { 0 <= n }
    requires { n < a.length }
    ensures  { result = sum a 1 (n+1) }
    diverges
  = let i = ref 1 in
    let s = ref 0 in
    while !i <= n do
      invariant { true }
      s := !s + a[!i];
      i := !i + 1
    done;
    !s

end